<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7">
  <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8">
  <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9">
  <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    ``
    <![endif]-->
    <title>Assignment-4</title>
    <meta name="description" content="Queen, premium HTML5&amp;CSS3 template">
    <meta name="author" content="MosaicDesign">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="css/theme-style.css">
    <link rel="stylesheet" href="css/ie.style.css">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->
    <!--[if IE 7]>
    <link rel="stylesheet" href="css/font-awesome-ie7.css">
    <![endif]-->
    <script src="js/vendor/modernizr.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <!--[if IE 8]><script src="js/vendor/less-1.3.3.js"></script><![endif]-->
    <!--[if gt IE 8]><!-->
    <script src="js/vendor/less.js"></script><!--<![endif]-->
</head>
<body>
    <div id="index">
        <!-- Header-->
        <!-- Header-->
        <header id="header">
            <div class="header-top-login">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-6 col-md-4 col-md-offset-2 col-lg-4  col-lg-offset-2 ">
                            <div class="block-form">
                                <h3>Account login</h3>
                                <form>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <input type="email" id="email-signin" class="form-control" name='email' placeholder="Email">
                                        </div>
                                        <div class="col-md-12">
                                            <input type="password" id="password-signin" class="form-control" name='password' placeholder="Password">
                                        </div>
                                        <div class="col-md-12">
                                            <input type="button" value="Login" class="btn-default-1" onclick="login()">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-4">
                            <div class="block-form">
                                <h3>Create new account</h3>
                                <form action="#" method="post">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <input type="email" id="email-reg" class="form-control" placeholder="Email">
                                        </div>
                                        <div class="col-md-12">
                                            <input type="password" id="password-reg" class="form-control" placeholder="Password">
                                        </div>
                                        <div class="col-md-12">
                                            <input type="button" value="Signup" class="btn-default-1" onclick="register()">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-2 col-lg-2 text-center">
                        </div>
                    </div>
                </div>
                <a href="#" id="header-login-close"><i class="icon-remove"></i> </a>
            </div>
            <div class="header-top-row">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <!-- header-account menu -->
                            <ul class="account-menu-list list-unstyled">
                                <li><a href="/profile.html">Account</a></li>
                                <li><a href="/cart.html">Cart</a></li>
                            </ul>
                            <!-- /header-account menu -->
                        </div>
                        <div class="col-md-4">
                            <div id="first-welcome">
                                <p> Welcome <span id="user-details">visitor you can  <a href="#" id="header-login"> Login or Sign Up</a> </span> </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /header-top-row -->
            <div class="header-bg">
                <div class="header-main" id="header-main-fixed">
                    <div class="container">
                        <div id="container-fixed">
                            <div class="row">
                                <div class="col-md-6">
                                    <a href="/index.html" class="header-logo pull-left"></a>
                                </div>
                                <div class="col-md-6">
                                    <div class="header-mini-cart  pull-right">
                                        <a href="#" data-toggle="dropdown">
                                            <span id="cart_items">{{cart_count}}</span>
                                        </a>
                                        <div class="dropdown-menu shopping-cart-content pull-right">
                                            <div class="shopping-cart-items">
                                            </div>
                                            <div class="shopping-cart-total">
                                                <div class="total pull-left">
                                                    <template v-for="(item, index) in products">
                                                        <div class="item pull-left">
                                                            <img :src="item.imgurl" alt="Product Name" class="pull-left">
                                                            <div class="pull-left">
                                                                <p> {{item.name}} </p>
                                                                <p>$ {{item.offer_price}} &nbsp;<strong>x {{item._collection}}</strong></p>
                                                            </div>
                                                            <a href="" class="pull-right" @click="removeProduct(index)"><i class="icon-trash icon-large pull-left"></i></a>
                                                        </div>
                                                    </template>
                                                    <a href="/cart.html" class="btn-read pull-right" id="view_cart">View Cart</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /header-mini-cart -->
                                    <div class="top-search-form  pull-right">
                                        <form action="#" method="post">
                                            <input type="text" placeholder="Search ...">
                                            <button type="submit"><i class="icon-search"></i></button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="navbar yamm navbar-main" role="navigation">
                        <div class="border-menu-top"></div>
                        <div class="container">
                            <div class="navbar-header">
                                <button type="button" data-toggle="collapse" data-target="#navbar-collapse-1" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                                <a href="/" class="navbar-brand"><i class="icon-home"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /header-main-menu -->
            </div>
        </header>
        <!-- End header -->
        <section>
            <div class="block">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="block-product-tab">
                                <ul class="nav nav-pills  nav-justified">
                                    <li>
                                        <a href="#new" data-toggle="tab" @click="LoadNew()">New</a>
                                        <div class="header-bottom-line"></div>
                                    </li>
                                    <li class="active">
                                        <a href="#featured" data-toggle="tab" class="disabled" @click="LoadFeatured()">Featured</a>
                                        <div class="header-bottom-line"></div>
                                    </li>
                                    <li>
                                        <a href="#top" data-toggle="tab" @click="LoadTop()">Top</a>
                                        <div class="header-bottom-line"></div>
                                    </li>
                                </ul>
                                <div class="tab-content product-section">
                                    <div class="tab-pane animated fadeIn" id="new">
                                        <ul class="row list-unstyled" id="newProductsList">
                                            <template v-for="(item, index) in list_products">
                                                <li class="col-xs-12 col-sm-6 col-md-4 col-lg-4 text-center">
                                                    <div class="product">
                                                        <figure class="figure-hover-overlay">
                                                            <a href="#" class="figure-href" @click="gotoDetails(index)"></a>
                                                            <img :src="item.imgurl" alt="Image" class="img-responsive">
                                                            <span class="bar"></span>
                                                            <figcaption>
                                                                <a href="#" class="shoping" @click="addtoCart(index)"><i class="glyphicon glyphicon-shopping-cart"></i></a>
                                                            </figcaption>
                                                        </figure>
                                                        <div class="product-caption" @click="gotoDetails(index)">
                                                            <a href="#" class="product-name">{{item.name}}</a>
                                                            <p class="product-price"><span>$ {{item.actual_price}}$</span> $ {{item.offer_price}}$</p>
                                                            <div class="product-rating">
                                                                <div class="stars">
                                                                    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                    <div class="tab-pane active animated fadeIn" id="featured">
                                        <ul class="row list-unstyled" id="featuredProductsList">
                                            <template v-for="(item, index) in list_products">
                                                <li class="col-xs-12 col-sm-6 col-md-4 col-lg-4 text-center">
                                                    <div class="product">
                                                        <figure class="figure-hover-overlay">
                                                            <a href="#" class="figure-href" @click="gotoDetails(index)"></a>
                                                            <img :src="item.imgurl" alt="Image" class="img-responsive">
                                                            <span class="bar"></span>
                                                            <figcaption>
                                                                <a href="#" class="shoping" @click="addtoCart(index)"><i class="glyphicon glyphicon-shopping-cart"></i></a>
                                                            </figcaption>
                                                        </figure>
                                                        <div class="product-caption" @click="gotoDetails(index)">
                                                            <a href="#" class="product-name">{{item.name}}</a>
                                                            <p class="product-price"><span>$ {{item.actual_price}}$</span> $ {{item.offer_price}}$</p>
                                                            <div class="product-rating">
                                                                <div class="stars">
                                                                    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                    <div class="tab-pane animated fadeIn" id="top">
                                        <ul class="row list-unstyled" id="topProductsList">
                                            <template v-for="(item, index) in list_products">
                                                <li class="col-xs-12 col-sm-6 col-md-4 col-lg-4 text-center">
                                                    <div class="product">
                                                        <figure class="figure-hover-overlay">
                                                            <a href="#" class="figure-href" @click="gotoDetails(index)"></a>
                                                            <img :src="item.imgurl" alt="Image" class="img-responsive">
                                                            <span class="bar"></span>
                                                            <figcaption>
                                                                <a href="#" class="shoping" @click="addtoCart(index)"><i class="glyphicon glyphicon-shopping-cart"></i></a>
                                                            </figcaption>
                                                        </figure>
                                                        <div class="product-caption" @click="gotoDetails(index)">
                                                            <a href="#" class="product-name">{{item.name}}</a>
                                                            <p class="product-price"><span>$ {{item.actual_price}}$</span> $ {{item.offer_price}}$</p>
                                                            <div class="product-rating">
                                                                <div class="stars">
                                                                    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- End Section footer -->
    <script type="text/javascript" src="./js/vendor/jquery.js"></script>
    <script type="text/javascript" src="./js/vendor/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="./js/vendor/bootstrap.js"></script>
    <script src="js/vendor/jquery.flexisel.js"></script>
    <script src="js/vendor/jquery.transit.js"></script>
    <script src="js/vendor/jquery.jcountdown.js"></script>
    <script src="js/vendor/jquery.jPages.js"></script>
    <script src="js/vendor/tab.js"></script>
    <script src="js/vendor/responsiveslides.min.js"></script>
    <script src="js/vendor/jquery.elevateZoom-3.0.8.min.js"></script>
    <!-- jQuery REVOLUTION Slider  -->
    <script type="text/javascript" src="js/vendor/jquery.themepunch.plugins.min.js"></script>
    <script type="text/javascript" src="js/vendor/jquery.themepunch.revolution.min.js"></script>
    <script type="text/javascript" src="js/vendor/jquery.scrollTo-1.4.2-min.js"></script>
    <!-- Custome Slider  -->
    <script src="js/main.js"></script>
    <!-- Load Index JS -->
    <script src="js/index.js"></script>
</body>
</html>
<script>
    let x = new Vue({
        el: '#index',
        data: {
            products: [],
            list_products: [],
            cart_count: 0,
        },
        methods: {
            formatPrice(value) {
                let val = (value / 1).toFixed(2)
                return val.toString()
            },
            addtoCart: async function (index) {
                console.log("LoadNew");
                
                var product = this.list_products[index].id;
                if (product == '') {
                    var url = window.location.search;
                    product = url.substring(url.lastIndexOf('=') + 1);
                }
                data = { userID: 'Xyz123', productID: product, quantity: 1 };
                var result = await fetch('http://localhost:5000/addtoCart', {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    }
                });
                let response = await result.text();
                let productsList = JSON.parse(response);
                this.products = productsList['items'];
                this.cart_count = productsList['count'];
            },
            gotoDetails: async function (index) {
                console.log(index);
                if (index != '') {
                    window.location.href = 'http://localhost:5000/product.html?id=' + this.list_products[index].id;
                } else {
                    window.location.href = 'http://localhost:5000/index.html';
                }
            },
            loadCart: async function () {
                console.log("LoadNew")
                var result = await fetch('http://localhost:5000/getCartItems', {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'userID': 'Xyz123'
                    }
                });
                let response = await result.text();
                let productsList = JSON.parse(response);
                this.products = productsList['items'];
                this.cart_count = productsList['count']
            },
            getUser: async function () {
                var result = await fetch('http://localhost:5000/getUser', {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    }
                });
                let response = await result.text();
                let user = JSON.parse(response);
                if (user.email != "") {
                    console.log(user.email)
                    document.getElementById('user-details').innerHTML = user.email;
                }
            },
            LoadFeatured: async function () {
                var result = await fetch('http://localhost:5000/getProducts/featured', {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    }
                });
                let response = await result.text();
                let productsList = JSON.parse(response);
                this.list_products = productsList
            },
            LoadNew: async function () {
                var result = await fetch('http://localhost:5000/getProducts/new', {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    }
                });
                let response = await result.text();
                let productsList = JSON.parse(response);
                this.list_products = productsList
            },
            LoadTop: async function () {
                var result = await fetch('http://localhost:5000/getProducts/top', {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    }
                });
                let response = await result.text();
                let productsList = JSON.parse(response);
                this.list_products = productsList
            }
        },
        mounted: function () {
            this.LoadFeatured();
            this.getUser();
            this.loadCart();
        },

    });
    // Payment Gateway
    $('#stripe-button').click(function () {
        var amount = parseFloat($('#total_cost').val()) * 100;
        $("#stripe-button").html(
            '<input type="hidden" name="amount" value="' + amount + '" /><input type="hidden" name="currency" value="cad" /><script src="https://checkout.stripe.com/checkout.js" class="stripe-button" data-key="pk_test_TYooMQauvdEDq54NiTphI7jx" data-amount="' + amount + '" data-zip-code="true" data-currency="cad" data-billing-address="true" data-shipping-address="true" data-name="Company Name" data-description="Product Name" data-image="https://stripe.com/img/documentation/checkout/marketplace.png" data-locale="auto"><script>'
        );
    });
</script>