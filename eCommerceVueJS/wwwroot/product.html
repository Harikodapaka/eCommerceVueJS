<!DOCTYPE html>
<html lang="en" class="no-js">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<!--[if IE]>
			<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
			``
			<![endif]-->
	<title>Assignment 1</title>
	<meta name="description" content="Queen, premium HTML5&amp;CSS3 template">
	<meta name="author" content="MosaicDesign">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="css/theme-style.css">
	<link rel="stylesheet" href="css/ie.style.css">
	<script src="js/vendor/modernizr.js"></script>
	<script src="https://unpkg.com/vue"></script>
	<!--[if IE 8]><script src="js/vendor/less-1.3.3.js"></script><![endif]-->
	<!--[if gt IE 8]><!-->
	<script src="js/vendor/less.js"></script>
	<!--<![endif]-->
</head>
<body>
	<div id="products">
		<!-- Header-->
		<header id="header">
			<div class="header-top-login">
				<div class="container">
					<div class="row">
						<div class="col-sm-6 col-md-4 col-md-offset-2 col-lg-4  col-lg-offset-2 ">
							<div class="block-form">
								<h3>Account login</h3>
								<form>
									<div class="row">
										<div class="col-md-12">
											<input type="email" id="email-signin" class="form-control" name='email' placeholder="Email">
										</div>
										<div class="col-md-12">
											<input type="password" id="password-signin" class="form-control" name='password' placeholder="Password">
										</div>
										<div class="col-md-12">
											<input type="button" value="Login" class="btn-default-1" onclick="login()">
										</div>
									</div>
								</form>
							</div>
						</div>
						<div class="col-sm-6 col-md-4 col-lg-4">
							<div class="block-form">
								<h3>Create new account</h3>
								<form action="#" method="post">
									<div class="row">
										<div class="col-md-12">
											<input type="email" id="email-reg" class="form-control" placeholder="Email">
										</div>
										<div class="col-md-12">
											<input type="password" id="password-reg" class="form-control" placeholder="Password">
										</div>
										<div class="col-md-12">
											<input type="button" value="Signup" class="btn-default-1" onclick="register()">
										</div>
									</div>
								</form>
							</div>
						</div>
						<div class="col-sm-12 col-md-2 col-lg-2 text-center">
						</div>
					</div>
				</div>
				<a href="#" id="header-login-close"><i class="icon-remove"></i> </a>
			</div>
			<div class="header-top-row">
				<div class="container">
					<div class="row">
						<div class="col-md-4">
							<!-- header-account menu -->
							<ul class="account-menu-list list-unstyled">
								<li><a href="/profile.html">Account</a></li>
								<li><a href="/cart.html">Cart</a></li>
							</ul>
							<!-- /header-account menu -->
						</div>
						<div class="col-md-4">
							<div id="first-welcome">
								<p> Welcome <span id="user-details">visitor you can  <a href="#" id="header-login"> Login or Sign Up</a> </span> </p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /header-top-row -->
			<div class="header-bg">
				<div class="header-main" id="header-main-fixed">
					<div class="container">
						<div id="container-fixed">
							<div class="row">
								<div class="col-md-6">
									<a href="/index.html" class="header-logo pull-left"></a>
								</div>
								<div class="col-md-6">
									<div class="header-mini-cart  pull-right">
										<a href="#" data-toggle="dropdown">
											<span id="cart_items">0</span>
										</a>
										<div class="dropdown-menu shopping-cart-content pull-right">
											<div class="shopping-cart-items">
											</div>
											<div class="shopping-cart-total">
												<div class="total pull-left">

													<a href="/cart.html" class="btn-read pull-right" id="view_cart">View Cart</a>
												</div>
											</div>
										</div>
									</div>
									<!-- /header-mini-cart -->
									<div class="top-search-form  pull-right">
										<form action="#" method="post">
											<input type="text" placeholder="Search ...">
											<button type="submit"><i class="icon-search"></i></button>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="navbar yamm navbar-main" role="navigation">
						<div class="border-menu-top"></div>
						<div class="container">
							<div class="navbar-header">
								<button type="button" data-toggle="collapse" data-target="#navbar-collapse-1" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
								<a href="/" class="navbar-brand"><i class="icon-home"></i></a>
							</div>
						</div>
					</div>
				</div>
				<!-- /header-main-menu -->
			</div>
		</header>
		<section>
			<div class="block-breadcrumb color-scheme-3">
				<div class="container">
					<ul class="breadcrumb">
						<li><a href="/index.html">Home</a></li>
						<li class="active">Product Details</li>
					</ul>
				</div>
			</div>
		</section>
		<section>
			<div class="color-scheme-3">
				<div class="container">
					<div class="row">
						<div class="product-detail-section col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<div class="product-list">
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<div class="product-image">
											<img id="product-zoom" :src="product.imgurl" data-zoom-image="http://placehold.it/800x900"
												 alt="">
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<h3 id="product_name">{{product.name}}</h3>
										<div class="product-rating">
											<div class="stars">
												<span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
											</div>
										</div>
										<div class="product-information">
											<div class="clearfix">
												<label class="pull-left">Brand:</label> <a href="#" id="product_brand">{{product.brand}}</a><br>
											</div>
											<div class="clearfix">
												<label class="pull-left">Collection:</label> <span id="product_collection">{{product._collection}}</span>
											</div>
											<div class="clearfix">
												<label class="pull-left">Price:</label>
												<p class="product-price">$<span id="product_actualPrice">{{product.actual_price}}</span> $<label id="product_offer_price">{{product.offer_price}}</label></p>
											</div>

											<div class="list-shopping-cart text-center">
												<a class="shoping" @click="addtoCart('')"><i class="glyphicon glyphicon-shopping-cart"></i></a>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="box-border block-form">
								<!-- Nav tabs -->
								<ul class="nav nav-pills  nav-justified">
									<li class="active"><a href="#description" data-toggle="tab">Description</a></li>
									<li><a href="#review" data-toggle="tab" @click="loadComments">Review</a></li>
								</ul>
								<!-- Tab panes -->
								<div class="tab-content">
									<div class="tab-pane active" id="description">
										<br>
										<h3>Product Details</h3>
										<hr>
										<p id="product_description">{{product.description}}</p>

									</div>
									<div class="tab-pane" id="review">
										<br>
										<div class="row">
											<div class="col-md-12">
												<h3>Clients review</h3>
												<hr>
												<div id="commentsSection" v-for="comment in commentList">
													<div class="review-header">
														<h5>{{comment.userName}}</h5>
														<div class="product-rating">
															<div class="">Rating : {{comment.rating}}</div>
														</div>
														<small class="text-muted">{{comment.updatedAt}}</small>
													</div>
													<div class="review-body">
														<p>{{comment.commentDescription}}</p>
													</div>
													<hr>
												</div>
											</div>
										</div>
										<div class="col-md-12">
											<div class="form-group">
												<label for="inputComment" class="control-label">Comment:<span class="text-error">*</span></label>
												<textarea class="form-control" v-model="comment" id="reviews-comment"></textarea>
											</div>
										</div>
										<div class="col-md-12">
											<div class="form-group">
												<label class="control-label">Your Rate:</label>
												<div class="product-rating" id="reviews-rating">
													<div class="stars">
														<span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
													</div>
												</div>
											</div>
										</div>
										<input type="button" @click="addReview" class="btn-default-1" value="Add Review">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>

	<script>
		let x = new Vue({
			el: '#products',
			data: {
				product: undefined,
				comment: '',
				rating: 1,
				commentList: [],
				file: undefined
			},
			methods: {
				onDetailsLoad: async function () {
					var url = window.location.search;
					var id = url.substring(url.lastIndexOf('=') + 1);
					var result = await fetch('http://localhost:5000/getProductDetails/' + id, {
						method: 'GET',
						mode: 'cors',
						cache: 'no-cache',
						headers: {
							'Content-Type': 'application/json; charset=utf-8',
						}
					});
					let response = await result.text();
					let productsList = JSON.parse(response);
					this.product = productsList.product;
				},
				pullCartList: async function () {
					var result = await fetch('http://localhost:5000/getCartItems', {
						method: 'GET',
						mode: 'cors',
						cache: 'no-cache',
						headers: {
							'Content-Type': 'application/json; charset=utf-8'
						}
					});
					let response = await result.text();
					let cartList = JSON.parse(response);
					this.createCart(cartList);

				},
				createCart: function (cart) {
					$('#cart_items').html(cart['count'])

					cart['items'].forEach(product => {
						console.log(product)
						var NewProducts = $(`
											<div class="item pull-left">
											<img src="${product.imgurl}" alt="Product Name" class="pull-left">
											<div class="pull-left">
											<p> ${product.name} </p>
											<p>$ ${product.offer_price} &nbsp;<strong>x ${product._collection}</strong></p>
											</div>
											<a href="" class="pull-right"><i class="icon-trash icon-large pull-left"></i></a>
										</div>`);
						NewProducts.appendTo($('.shopping-cart-items'));
					});

					$('#sub_total').html(cart['total']['sub_total']);
					$('#hst_cost').html(cart['total']['hst']);
					$('#total_cost').html(cart['total']['total']);
				},
				getUser: async function () {
					var result = await fetch('http://localhost:5000/getUser', {
						method: 'GET',
						mode: 'cors',
						credentials: 'include',
						headers: {
							'Content-Type': 'application/json; charset=utf-8',
						}
					});
					let response = await result.text();
					let user = JSON.parse(response);
					if (user.email != "") {
						console.log(user.email)
						document.getElementById('user-details').innerHTML = user.email;
					}
				},
				addtoCart: async function (product) {
					console.log("LoadNew");
					if (product == '') {
						var url = window.location.search;
						product = url.substring(url.lastIndexOf('=') + 1);
					}
					data = { userID: 'Xyz123', productID: product, quantity: 1 };
					var result = await fetch('http://localhost:5000/addtoCart', {
						method: 'POST',
						mode: 'cors',
						cache: 'no-cache',
						body: JSON.stringify(data),
						headers: {
							'Content-Type': 'application/json; charset=utf-8',
						}
					});
					let response = await result.text();
					let cart = JSON.parse(response);
				},
				addReview: async function () {
					
					var url = window.location.search;
					var id = url.substring(url.lastIndexOf('=') + 1);
					data = { 'commentDescription': this.comment, 'rating': this.rating || 1, 'userID': 'Xyz123', 'productID': id };
					var result = await fetch('http://localhost:5000/postComments', {
						method: 'POST',
						mode: 'cors',
						cache: 'no-cache',
						body: JSON.stringify(data),
						headers: {
							'Content-Type': 'application/json; charset=utf-8',
						}
					});
					loadComments();
					this.comment = "";
				},
				loadComments: async function () {
					var url = window.location.search;
					var id = url.substring(url.lastIndexOf('=') + 1);
					var result = await fetch('http://localhost:5000/getComments/' + id, {
						method: 'GET',
						mode: 'cors',
						cache: 'no-cache',
						headers: {
							'Content-Type': 'application/json; charset=utf-8',
						}
					});
					let response = await result.text();
					let commentsList = JSON.parse(response);
					let users = commentsList.users;
					//let productsList = document.getElementById('commentsSection');
					//productsList.innerHTML = ""; 
					commentsList.results.forEach((item) => {
						let user = users.find((u) => { return item.userID == u.id });
						item['userName'] = user.firstName + ' ' + user.lastName;
						this.commentList.push(item);
						console.log(this.commentList);

					});
				}
			},
			mounted: function () {
				this.onDetailsLoad();
				this.pullCartList();
				this.getUser();
			},

		});
	</script>
	<!-- End Section footer -->
	<script src="js/vendor/jquery.js"></script>
	<script src="js/vendor/jquery.easing.1.3.js"></script>
	<script src="js/vendor/bootstrap.js"></script>
	<script src="js/vendor/jquery.flexisel.js"></script>
	<script src="js/vendor/jquery.transit.js"></script>
	<script src="js/vendor/jquery.jcountdown.js"></script>
	<script src="js/vendor/jquery.jPages.js"></script>
	<script src="js/vendor/tab.js"></script>
	<script src="js/vendor/responsiveslides.min.js"></script>
	<!-- <script src="js/vendor/jquery.elevateZoom-3.0.8.min.js"></script> -->
	<!-- jQuery REVOLUTION Slider  -->
	<script type="text/javascript" src="js/vendor/jquery.themepunch.plugins.min.js"></script>
	<script type="text/javascript" src="js/vendor/jquery.themepunch.revolution.min.js"></script>
	<script type="text/javascript" src="js/vendor/jquery.scrollTo-1.4.2-min.js"></script>
	<!-- Custome Slider  -->
	<script src="js/main.js"></script>
	<script src="js/index.js"></script>
	<!-- Load Header JS -->
	<script src="js/header.js"></script>
	<!--Here will be Google Analytics code from BoilerPlate-->
</body>
</html>